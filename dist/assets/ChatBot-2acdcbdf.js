import{d as U,r,b as V,o,c as l,a as s,i as y,w as x,v as I,h as R,P as n,p as A,k as F,_ as H,t as T,s as j,F as B,x as L,y as q,m as D}from"./index-e0bbab80.js";import{_ as K,a as Y}from"./send-89db135c.js";import{a as $,s as i}from"./Toast-c3e54b23.js";import{s as G}from"./SpinerComponent-e28aa22b.js";import{l as Q}from"./SwitchLang-3e3dc634.js";const P=g=>(A("data-v-718c6c2f"),g=g(),F(),g),X={class:"modal"},J={class:"modal-content"},W={key:0},Z={key:0,class:"modal-title"},ee={key:1,class:"modal-title"},te={key:2,class:"text-center mb-1"},se={key:0,class:"form-group"},ae={class:"form-group"},oe={class:"form-group"},le={key:1,class:"form-group"},re={key:4,class:"w-100 text-center mt-1"},ne={key:5,class:"w-100 text-center mt-1"},ie={key:1},ue=P(()=>s("h2",null,"Limite alcanzado",-1)),ce=P(()=>s("p",{class:"text-center mb-1"},"Has alcanzado el límite de consultas diarias, ¿quieres seguir usando el chat, considera contratar uno de nuestros planes.",-1)),de=[ue,ce],M="https://api-chatbot.letsdoitnow.us/api",ve=U({__name:"LoginBot",props:{closeModal:Function},setup(g){const m=g,u=r(""),c=r(""),h=r(""),v=r(""),_=r(!1),d=r(!1),p=r(""),f=r(),O=r(!1),E=r(!1),k=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,C=()=>{u.value="",c.value="",h.value=""},b=async()=>{try{const t=await $.get(`${M}/user/temp`);t.status===200?(localStorage.setItem("session",t.data.token+"-"+t.data.user),m.closeModal&&m.closeModal(),window.location.reload()):i("Error al cargar","error",3e3,n.BOTTOM_CENTER)}catch{i("Error al cargar","error",3e3,n.BOTTOM_CENTER)}},w=async()=>{if(E.value=!0,!k.test(u.value))i("El email no es válido","error",3e3,n.BOTTOM_CENTER);else if(!v.value||!c.value||!h.value)i("Todos los campos son obligatorios","error",3e3,n.BOTTOM_CENTER);else if(c.value!==h.value)i("Las contraseñas no coinciden","error",3e3,n.BOTTOM_CENTER);else try{let t;p.value?t={userId:p.value,name:v.value,email:u.value,password:c.value}:t={name:v.value,email:u.value,password:c.value};let e=await $.post(`${M}/user`,t,{});localStorage.setItem("session",e.data.token+"-"+e.data.user),i("Registrado correctamente","success",2e3,n.BOTTOM_CENTER),m.closeModal&&m.closeModal(),setTimeout(()=>{window.location.reload()},1200),C()}catch(t){t.response.data.message=="A user with this email already exists."?i("Correo registrado","error",3e3,n.BOTTOM_CENTER):i(`Error al registrar ${t}`,"error",3e3,n.BOTTOM_CENTER)}E.value=!1},S=()=>{E.value=!0,k.test(u.value)?c.value?$.post(`${M}/login`,{email:u.value,password:c.value},{}).then(t=>{localStorage.setItem("session",t.data.token+"-"+t.data.user),i("Iniciado correctamente","success",2e3,n.BOTTOM_CENTER),m.closeModal&&m.closeModal(),setTimeout(()=>{window.location.reload()},1200),C()}).catch(t=>{t.response.data.message=="Invalid email or password."?i("Contraseña o correo incorrectos","error",3e3,n.BOTTOM_CENTER):i(`Error al iniciar ${t}`,"error",3e3,n.BOTTOM_CENTER)}):i("Todos los campos son obligatorios","error",3e3,n.BOTTOM_CENTER):i("El email no es válido","error",3e3,n.BOTTOM_CENTER),E.value=!1};return V(async()=>{if(localStorage.getItem("limit")&&(d.value=!0,localStorage.removeItem("limit")),localStorage.getItem("registerLimit")&&(O.value=!0,localStorage.removeItem("registerLimit")),localStorage.getItem("session")){const e=(localStorage.getItem("session")||"").split("-")||"";f.value=e.slice(0,e.length-1).toString(),p.value=e[e.length-1]}else f.value="",p.value=""}),(t,e)=>(o(),l("div",X,[s("div",J,[s("span",{class:"close",onClick:e[0]||(e[0]=a=>b())},"×"),O.value?(o(),l("div",ie,de)):(o(),l("div",W,[_.value?(o(),l("h2",Z,"Iniciar sesión")):(o(),l("h2",ee,"Registro")),d.value?(o(),l("p",te,"Has alcanzado el límite de consultas gratuitas, regístrate para continuar usando el chat y no perder el historial.")):y("",!0),s("form",null,[_.value?y("",!0):(o(),l("div",se,[x(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),type:"text",placeholder:"Nombre",required:""},null,512),[[I,v.value]])])),s("div",ae,[x(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),type:"email",placeholder:"Email",required:""},null,512),[[I,u.value]])]),s("div",oe,[x(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),type:"password",placeholder:"Password",required:""},null,512),[[I,c.value]])]),_.value?y("",!0):(o(),l("div",le,[x(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),type:"password",placeholder:"Confirmar password",required:""},null,512),[[I,h.value]])])),_.value?(o(),l("button",{key:2,class:"submit",onClick:e[5]||(e[5]=a=>S())},"Iniciar sesión")):(o(),l("button",{key:3,class:"submit",onClick:e[6]||(e[6]=a=>w())},"Registrarse")),_.value?(o(),l("p",ne,[R("¿No tienes cuenta? regístrate "),s("span",{class:"cursor-p text-primary",onClick:e[8]||(e[8]=a=>_.value=!1)},"aquí")])):(o(),l("p",re,[R("¿Ya tienes cuenta? inicia sesión "),s("span",{class:"cursor-p text-primary",onClick:e[7]||(e[7]=a=>_.value=!0)},"aquí")])),_.value?y("",!0):(o(),l("p",{key:6,class:"w-100 text-center mt-1 text-primary cursor-p",onClick:e[9]||(e[9]=a=>b())},"Continuar sin cuenta"))])]))])]))}});const pe=H(ve,[["__scopeId","data-v-718c6c2f"]]),z=g=>(A("data-v-0ad63fb9"),g=g(),F(),g),me={class:"max-w-550 px-1 mx-auto mb-1"},_e={class:"d-flex si-center py-1"},ge=z(()=>s("img",{src:Y,alt:""},null,-1)),he={class:"d-flex jc-fe flex-d-col"},fe={key:0,class:"m-0 text-left"},Te={key:1},ye=["value"],Ee={class:"d-ib va-t w-50 p-2 mt-1 bot"},we={class:"answerbot pr-1"},xe={key:0},$e={class:"botanswer",style:{"white-space":"pre-line"}},ke={class:"send"},Ce={class:"botanswer",style:{"white-space":"pre-line"}},Ie=z(()=>s("div",{id:"endChat",class:"mt-2 w-100"},null,-1)),Oe={class:"d-flex ai-center inputUser mt-1",style:{position:"relative"}},be={class:"text-center mt-2"},Se={href:"https://forms.gle/Nj27Lg1eXGhv6eeT6",target:"_blank"},N="https://api-chatbot.letsdoitnow.us/api",Be=U({__name:"ChatBot",setup(g){const m=r({}),u=r(""),c=r(""),h=r(""),v=r([{question:"",answer:""}]),_=r([{career:""}]),d=r({}),p=r(!1),f=r(!1),O=async()=>{f.value=!1},E=async()=>{p.value=!0;try{const t=await $.post(`${N}/experts`,{user:c.value},{headers:{token:h.value}});t.status===200?(_.value=t.data,d.value=t.data[t.data.length-1]):f.value=!0}catch{i("Error al cargar","error",3e3,n.BOTTOM_CENTER)}p.value=!1},k=async()=>{p.value=!0;try{const t=await $.post(`${N}/chats/expert`,{userId:c.value,expertId:d.value._id},{headers:{token:h.value}});v.value=t.data.slice().reverse()}catch(t){i(`Error al cargar: ${t}`,"error",3e3,n.BOTTOM_CENTER)}p.value=!1},C=async()=>{p.value=!0,u.value!=""&&(v.value.push({question:u.value,answer:""}),w(),await $.post(`${N}/chats`,{userId:c.value,expertId:d.value._id,userQuestion:u.value},{headers:{token:h.value}}).then(t=>{v.value[v.value.length-1].answer=t.data.answer,u.value="",w()}).catch(t=>{t.response.data.message=="You have exceeded the number of free queries."?(i("Has excedido el número de consultas gratuitas","error",3e3,n.BOTTOM_CENTER),localStorage.setItem("limit","true"),f.value=!0):t.response.data.message=="User, you have exceeded the number of free queries."?(localStorage.setItem("registerLimit","true"),f.value=!0):i(`Error al enviar: ${t}`,"error",3e3,n.BOTTOM_CENTER)})),p.value=!1,w()},b=async()=>{const t=localStorage.getItem("session");if(t){const e=t.split("-");h.value=e.slice(0,e.length-1).toString(),c.value=e[e.length-1],await E(),await k()}else f.value=!0},w=()=>{const t=document.getElementById("endChat");t&&t.scrollIntoView({behavior:"smooth",block:"end"})},S=t=>{const e=t.indexOf("</end>");return e!==-1?t.substring(0,e):t};return V(async()=>{m.value=Q(localStorage.getItem("Lang")==="Es").doitbot,localStorage.getItem("chat")&&(u.value=localStorage.getItem("chat")||"",localStorage.removeItem("chat")),localStorage.getItem("session")?await b():f.value=!0,w()}),(t,e)=>(o(),l(B,null,[s("div",null,[s("div",me,[s("div",_e,[ge,s("div",he,[d.value.name?(o(),l("h3",fe,T(d.value.name),1)):y("",!0),d.value.career?(o(),l("p",Te,T(d.value.career),1)):y("",!0)])]),s("p",null,T(d.value.description),1)]),x(s("select",{name:"","onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),onChange:e[1]||(e[1]=a=>k())},[(o(!0),l(B,null,L(_.value,a=>(o(),l("option",{value:a},T(a.career),9,ye))),256))],544),[[j,d.value]])]),s("div",Ee,[s("div",we,[v.value.length==0?(o(),l("div",xe,[s("p",$e,T(m.value.text001),1)])):y("",!0),(o(!0),l(B,null,L(v.value,a=>(o(),l("div",null,[s("p",ke,T(a.question),1),s("p",Ce,T(S(a.answer)),1)]))),256)),Ie,p.value?(o(),q(G,{key:1})):y("",!0)]),s("div",Oe,[x(s("input",{class:"w-100",style:{"padding-right":"3rem"},type:"text",placeholder:"Escribe algo","onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),onKeypress:e[3]||(e[3]=D(a=>C(),["enter"]))},null,544),[[I,u.value]]),s("img",{style:{right:"10px",position:"absolute"},class:"cursor-p",src:K,alt:"",onClick:e[4]||(e[4]=a=>C())})])]),s("p",be,[R(T(m.value.text002)+" ",1),s("a",Se,T(m.value.text003),1)]),f.value?(o(),q(pe,{key:0,closeModal:O})):y("",!0)],64))}});const Ue=H(Be,[["__scopeId","data-v-0ad63fb9"]]);export{Ue as default};
