import{_ as L,o,c as l,p as U,k as q,a as s,d as z,r,b as A,i as E,s as j,w as x,v as I,h as R,P as i,t as f,x as D,F as B,y as V,z as F,m as K}from"./index-a6156a10.js";import{_ as Y,a as G}from"./send-89db135c.js";import{a as $,s as u}from"./Toast-9ca1fb0f.js";import{l as Q}from"./SwitchLang-3e3dc634.js";const X={},J=c=>(U("data-v-537dd02a"),c=c(),q(),c),W={class:"w-100 vh-100 d-flex ai-center jc-center spinnerCont"},Z=J(()=>s("div",{class:"spinner"},[s("div"),s("div"),s("div")],-1)),ee=[Z];function te(c,m){return o(),l("div",W,ee)}const se=L(X,[["render",te],["__scopeId","data-v-537dd02a"]]),H=c=>(U("data-v-c70a0f32"),c=c(),q(),c),ae={class:"modal"},oe={class:"modal-content"},le={key:0},re={key:0,class:"modal-title"},ne={key:1,class:"modal-title"},ie={key:2,class:"text-center mb-1"},ue={key:0,class:"form-group"},ce={class:"form-group"},de={class:"form-group"},ve={key:1,class:"form-group"},pe={key:4,class:"w-100 text-center mt-1"},me={key:5,class:"w-100 text-center mt-1"},_e={key:1},ge=H(()=>s("h2",null,"Limite alcanzado",-1)),he=H(()=>s("p",{class:"text-center mb-1"},"Has alcanzado el límite de consultas diarias, ¿quieres seguir usando el chat, considera contratar uno de nuestros planes.",-1)),fe=[ge,he],M="https://api-chatbot.letsdoitnow.us/api",Te=z({__name:"LoginBot",props:{closeModal:Function},setup(c){const m=c,p=r(""),v=r(""),_=r(""),T=r(""),n=r(!1),h=r(!1),g=r(""),O=r(""),k=r(!1),y=r(!1),C=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,b=()=>{p.value="",v.value="",_.value=""},w=async()=>{try{const t=await $.get(`${M}/user/temp`);t.status===200?(localStorage.setItem("session",t.data.token+"-"+t.data.user),m.closeModal(),window.location.reload()):u("Error al cargar","error",3e3,i.BOTTOM_CENTER)}catch{u("Error al cargar","error",3e3,i.BOTTOM_CENTER)}},S=async()=>{if(y.value=!0,!C.test(p.value))u("El email no es válido","error",3e3,i.BOTTOM_CENTER);else if(!T.value||!v.value||!_.value)u("Todos los campos son obligatorios","error",3e3,i.BOTTOM_CENTER);else if(v.value!==_.value)u("Las contraseñas no coinciden","error",3e3,i.BOTTOM_CENTER);else try{let t;g.value?t={userId:g.value,name:T.value,email:p.value,password:v.value}:t={name:T.value,email:p.value,password:v.value};let e=await $.post(`${M}/user`,t,{});localStorage.setItem("session",e.data.token+"-"+e.data.user),u("Registrado correctamente","success",2e3,i.BOTTOM_CENTER),m.closeModal(),setTimeout(()=>{window.location.reload()},1200),b()}catch(t){t.response.data.message=="A user with this email already exists."?u("Correo registrado","error",3e3,i.BOTTOM_CENTER):u(`Error al registrar ${t}`,"error",3e3,i.BOTTOM_CENTER)}y.value=!1},a=()=>{y.value=!0,C.test(p.value)?v.value?$.post(`${M}/login`,{email:p.value,password:v.value},{}).then(t=>{localStorage.setItem("session",t.data.token+"-"+t.data.user),u("Iniciado correctamente","success",2e3,i.BOTTOM_CENTER),m.closeModal(),setTimeout(()=>{window.location.reload()},1200),b()}).catch(t=>{t.response.data.message=="Invalid email or password."?u("Contraseña o correo incorrectos","error",3e3,i.BOTTOM_CENTER):u(`Error al iniciar ${t}`,"error",3e3,i.BOTTOM_CENTER)}):u("Todos los campos son obligatorios","error",3e3,i.BOTTOM_CENTER):u("El email no es válido","error",3e3,i.BOTTOM_CENTER),y.value=!1};return A(async()=>{if(localStorage.getItem("limit")&&(h.value=!0,localStorage.removeItem("limit")),localStorage.getItem("registerLimit")&&(k.value=!0,localStorage.removeItem("registerLimit")),localStorage.getItem("session")){const e=localStorage.getItem("session").split("-");O.value=e.slice(0,e.length-1),g.value=e[e.length-1]}else O.value="",g.value=""}),(t,e)=>(o(),l("div",ae,[s("div",oe,[s("span",{class:"close",onClick:e[0]||(e[0]=d=>w())},"×"),k.value?(o(),l("div",_e,fe)):(o(),l("div",le,[n.value?(o(),l("h2",re,"Iniciar sesión")):(o(),l("h2",ne,"Registro")),h.value?(o(),l("p",ie,"Has alcanzado el límite de consultas gratuitas, regístrate para continuar usando el chat y no perder el historial.")):E("",!0),s("form",{onSubmit:e[10]||(e[10]=j((...d)=>t.submitForm&&t.submitForm(...d),["prevent"]))},[n.value?E("",!0):(o(),l("div",ue,[x(s("input",{"onUpdate:modelValue":e[1]||(e[1]=d=>T.value=d),type:"text",placeholder:"Nombre",required:""},null,512),[[I,T.value]])])),s("div",ce,[x(s("input",{"onUpdate:modelValue":e[2]||(e[2]=d=>p.value=d),type:"email",placeholder:"Email",required:""},null,512),[[I,p.value]])]),s("div",de,[x(s("input",{"onUpdate:modelValue":e[3]||(e[3]=d=>v.value=d),type:"password",placeholder:"Password",required:""},null,512),[[I,v.value]])]),n.value?E("",!0):(o(),l("div",ve,[x(s("input",{"onUpdate:modelValue":e[4]||(e[4]=d=>_.value=d),type:"password",placeholder:"Confirmar password",required:""},null,512),[[I,_.value]])])),n.value?(o(),l("button",{key:2,class:"submit",onClick:e[5]||(e[5]=d=>a())},"Iniciar sesión")):(o(),l("button",{key:3,class:"submit",onClick:e[6]||(e[6]=d=>S())},"Registrarse")),n.value?(o(),l("p",me,[R("¿No tienes cuenta? regístrate "),s("span",{class:"cursor-p text-primary",onClick:e[8]||(e[8]=d=>n.value=!1)},"aquí")])):(o(),l("p",pe,[R("¿Ya tienes cuenta? inicia sesión "),s("span",{class:"cursor-p text-primary",onClick:e[7]||(e[7]=d=>n.value=!0)},"aquí")])),n.value?E("",!0):(o(),l("p",{key:6,class:"w-100 text-center mt-1 text-primary cursor-p",onClick:e[9]||(e[9]=d=>w())},"Continuar sin cuenta"))],32)]))])]))}});const ye=L(Te,[["__scopeId","data-v-c70a0f32"]]),P=c=>(U("data-v-be67b81e"),c=c(),q(),c),we={class:"max-w-550 px-1 mx-auto mb-1"},Ee={class:"d-flex si-center py-1"},xe=P(()=>s("img",{src:G,alt:""},null,-1)),$e={class:"d-flex jc-fe flex-d-col"},Ce={class:"m-0 text-left"},Ie=["value"],Oe={class:"d-ib va-t w-50 p-2 mt-1 bot"},ke={class:"answerbot pr-1"},be={key:0},Se={class:"botanswer",style:{"white-space":"pre-line"}},Be={class:"send"},Me={class:"botanswer",style:{"white-space":"pre-line"}},Ne=P(()=>s("div",{id:"endChat",class:"mt-2 w-100"},null,-1)),Re={class:"d-flex ai-center inputUser mt-1",style:{position:"relative"}},Le={class:"text-center mt-2"},Ue={href:"https://forms.gle/Nj27Lg1eXGhv6eeT6",target:"_blank"},N="https://api-chatbot.letsdoitnow.us/api",qe=z({__name:"ChatBot",setup(c){const m=r(""),p=r(""),v=r(""),_=r([]),T=r([]),n=r(""),h=r(!1),g=r(!1),O=async()=>{g.value=!1},k=async()=>{h.value=!0;try{const a=await $.post(`${N}/experts`,{user:p.value},{headers:{token:v.value}});a.status===200?(T.value=a.data,n.value=a.data[a.data.length-1]):g.value=!0}catch{u("Error al cargar","error",3e3,i.BOTTOM_CENTER)}h.value=!1},y=async()=>{h.value=!0;try{const a=await $.post(`${N}/chats/expert`,{userId:p.value,expertId:n.value._id},{headers:{token:v.value}});_.value=a.data.slice().reverse()}catch(a){u(`Error al cargar: ${a}`,"error",3e3,i.BOTTOM_CENTER)}h.value=!1},C=async()=>{h.value=!0,m.value!=""&&(_.value.push({question:m.value,answer:""}),w(),await $.post(`${N}/chats`,{userId:p.value,expertId:n.value._id,userQuestion:m.value},{headers:{token:v.value}}).then(a=>{_.value[_.value.length-1].answer=a.data.answer,m.value="",w()}).catch(a=>{a.response.data.message=="You have exceeded the number of free queries."?(u("Has excedido el número de consultas gratuitas","error",3e3,i.BOTTOM_CENTER),localStorage.setItem("limit","true"),g.value=!0):a.response.data.message=="User, you have exceeded the number of free queries."?(localStorage.setItem("registerLimit","true"),g.value=!0):u(`Error al enviar: ${a}`,"error",3e3,i.BOTTOM_CENTER)})),h.value=!1,w()},b=async()=>{const a=localStorage.getItem("session");if(a){const t=a.split("-");v.value=t.slice(0,t.length-1),p.value=t[t.length-1],await k(),await y()}else g.value=!0},w=()=>{const a=document.getElementById("endChat");a&&a.scrollIntoView({behavior:"smooth",block:"end"})},S=a=>{const t=a.indexOf("</end>");return t!==-1?a.substring(0,t):a};return A(async()=>{language.value=Q(localStorage.getItem("Lang")==="Es").home,localStorage.getItem("chat")&&(m.value=localStorage.getItem("chat"),localStorage.removeItem("chat")),localStorage.getItem("session")?await b():g.value=!0,w()}),(a,t)=>(o(),l(B,null,[s("div",null,[s("div",we,[s("div",Ee,[xe,s("div",$e,[s("h3",Ce,f(n.value.name),1),s("p",null,f(n.value.career),1)])]),s("p",null,f(n.value.description),1)]),x(s("select",{name:"","onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),onChange:t[1]||(t[1]=e=>y())},[(o(!0),l(B,null,V(T.value,e=>(o(),l("option",{value:e},f(e.career),9,Ie))),256))],544),[[D,n.value]])]),s("div",Oe,[s("div",ke,[_.value.length==0?(o(),l("div",be,[s("p",Se,f(a.language.text001),1)])):E("",!0),(o(!0),l(B,null,V(_.value,e=>(o(),l("div",null,[s("p",Be,f(e.question),1),s("p",Me,f(S(e.answer)),1)]))),256)),Ne,h.value?(o(),F(se,{key:1})):E("",!0)]),s("div",Re,[x(s("input",{class:"w-100",style:{"padding-right":"3rem"},type:"text",placeholder:"Escribe algo","onUpdate:modelValue":t[2]||(t[2]=e=>m.value=e),onKeypress:t[3]||(t[3]=K(e=>C(),["enter"]))},null,544),[[I,m.value]]),s("img",{style:{right:"10px",position:"absolute"},class:"cursor-p",src:Y,alt:"",onClick:t[4]||(t[4]=e=>C())})])]),s("p",Le,[R(f(a.language.text002)+" ",1),s("a",Ue,f(a.language.text003),1)]),g.value?(o(),F(ye,{key:0,closeModal:O})):E("",!0)],64))}});const He=L(qe,[["__scopeId","data-v-be67b81e"]]);export{He as default};
