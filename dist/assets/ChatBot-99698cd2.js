import{d as j,r as i,o as D,c as u,b as s,t as o,j as m,w as L,z as F,F as k,l as N,m as M,v as H,A as K,i as P,P as I,a as l,p as z,e as G,_ as Q}from"./index-a57a73d6.js";import{_ as X,a as Y,L as J}from"./LoginBot-4850f097.js";import{a as C}from"./axios-82afda87.js";import{S as W}from"./SpinerComponent-83d6d9b6.js";import{s as b}from"./Toast-f8515192.js";import{l as Z}from"./SwitchLang-31861cc9.js";const R=g=>(z("data-v-c426c8de"),g=g(),G(),g),ee={class:"max-w-550 px-1 mx-auto mb-1"},te={class:"d-flex si-center py-1"},se=R(()=>s("img",{src:Y,alt:""},null,-1)),ae={class:"d-flex jc-fe flex-d-col"},oe={key:0,class:"m-0 text-left"},le={key:1},ne=["value"],re={class:"d-ib va-t w-50 p-2 mt-1 bot"},ie={class:"answerbot pr-1"},ue={key:0},ce={class:"botanswer",style:{"white-space":"pre-line"}},de={class:"send"},ve={class:"botanswer",style:{"white-space":"pre-line"}},pe=R(()=>s("div",{id:"endChat",class:"mt-2 w-100"},null,-1)),me={key:0,class:"mt-8"},he={class:"d-flex ai-center inputUser mt-1",style:{position:"relative"}},_e={class:"text-center mt-2"},ge={href:"https://forms.gle/Nj27Lg1eXGhv6eeT6",target:"_blank"},S="https://api-chatbot.letsdoitnow.us/api",fe=j({__name:"ChatBot",setup(g){const f=i(),n=i(""),x=i(""),w=i(""),c=i([{question:"",answer:""}]),T=i([{career:""}]),r=i({_id:"",name:"",career:"",description:""}),v=i(!1),p=i(!1),d=i([]),U=async()=>{p.value=!1},V=async()=>{v.value=!0;try{const t=await C.post(`${S}/experts`,{user:x.value},{headers:{token:w.value}});t.status===200?(T.value=t.data,r.value=t.data[0]):p.value=!0}catch{b("Error al cargar","error",3e3,I.BOTTOM_CENTER)}v.value=!1},E=async()=>{var t;v.value=!0;try{const e=await C.post(`${S}/chats/expert`,{userId:x.value,expertId:(t=r.value)==null?void 0:t._id},{headers:{token:w.value}});c.value=e.data.reverse(),B()}catch(e){b(`Error al cargar: ${e}`,"error",3e3,I.BOTTOM_CENTER)}v.value=!1},h=async()=>{var t;v.value=!0,n.value!=""&&(c.value.push({question:n.value,answer:""}),y(),await C.post(`${S}/chats`,{userId:x.value,expertId:(t=r.value)==null?void 0:t._id,userQuestion:n.value},{headers:{token:w.value}}).then(e=>{E(),n.value="",y()}).catch(e=>{e.response.data.message=="You have exceeded the number of free queries."?(b("Has excedido el número de consultas gratuitas","error",3e3,I.BOTTOM_CENTER),localStorage.setItem("limit","true"),p.value=!0):e.response.data.message=="User, you have exceeded the number of free queries."?(localStorage.setItem("registerLimit","true"),p.value=!0):b(`Error al enviar: ${e}`,"error",3e3,I.BOTTOM_CENTER)})),v.value=!1,y()},q=async()=>{const t=localStorage.getItem("session");if(t){const e=t.split("-");w.value=e.slice(0,e.length-1).toString(),x.value=e[e.length-1],await V(),await E()}else p.value=!0},y=()=>{const t=document.getElementById("endChat");t&&t.scrollIntoView({behavior:"smooth",block:"end"})},A=t=>{const e=t.indexOf("</end>");return e!==-1?t.substring(0,e):t},B=()=>{const t=/(\¿.+?\?)/g;if(c.value.length>0){const e=c.value[c.value.length-1].answer,_=e.split("</end>")[e.split("</end>").length-1].match(t);_!==null&&(d.value=_)}};return D(async()=>{window.location.href="https://chatbot.letsdoitnow.us/doitbot/chat",f.value=Z(localStorage.getItem("Lang")==="Es").chatbot,localStorage.getItem("chat")&&(n.value=localStorage.getItem("chat")||"",localStorage.removeItem("chat")),localStorage.getItem("session")?await q():p.value=!0,y(),B()}),(t,e)=>{var _,O,$;return l(),u(k,null,[s("div",null,[s("div",ee,[s("div",te,[se,s("div",ae,[r.value.name?(l(),u("h3",oe,o(r.value.name),1)):m("",!0),r.value.career?(l(),u("p",le,o(r.value.career),1)):m("",!0)])]),s("p",null,o(r.value.description),1)]),L(s("select",{class:"p-4 py-2 outline-none bg-[#e9f5ec] border-0",name:"","onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),onChange:e[1]||(e[1]=a=>E())},[(l(!0),u(k,null,N(T.value,a=>(l(),u("option",{value:a},o(a.career),9,ne))),256))],544),[[F,r.value]])]),s("div",re,[s("div",ie,[c.value.length==0?(l(),u("div",ue,[s("p",ce,o((_=f.value)==null?void 0:_.text001),1)])):m("",!0),(l(!0),u(k,null,N(c.value,a=>(l(),u("div",null,[s("p",de,o(a.question),1),s("p",ve,o(A(a.answer)),1)]))),256)),pe,v.value?(l(),M(W,{key:1})):m("",!0)]),c.value.length!=0&&d.value?(l(),u("div",me,[s("p",{class:"send cursor-pointer text-xs",onClick:e[2]||(e[2]=a=>(n.value=d.value[0],h()))},o(d.value[0]),1),s("p",{class:"send cursor-pointer text-xs",onClick:e[3]||(e[3]=a=>(n.value=d.value[1],h()))},o(d.value[1]),1),s("p",{class:"send cursor-pointer text-xs",onClick:e[4]||(e[4]=a=>(n.value=d.value[2],h()))},o(d.value[2]),1)])):m("",!0),s("div",he,[L(s("input",{class:"w-100",style:{"padding-right":"3rem"},type:"text",placeholder:"Escribe algo","onUpdate:modelValue":e[5]||(e[5]=a=>n.value=a),onKeypress:e[6]||(e[6]=K(a=>h(),["enter"]))},null,544),[[H,n.value]]),s("img",{style:{right:"10px",position:"absolute"},class:"cursor-p",src:X,alt:"",onClick:e[7]||(e[7]=a=>h())})])]),s("p",_e,[P(o((O=f.value)==null?void 0:O.text002)+" ",1),s("a",ge,o(($=f.value)==null?void 0:$.text003),1)]),p.value?(l(),M(J,{key:0,closeModal:U})):m("",!0)],64)}}});const ke=Q(fe,[["__scopeId","data-v-c426c8de"]]);export{ke as default};
